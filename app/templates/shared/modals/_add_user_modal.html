<!-- Modal for Add User Form -->
{% from 'shared/macros/form_macros.html' import error_container %}

<div id="addUserModal" class="modal">
  <div class="modal-content">
    <button type="button" id="closeAddUserModal" class="close-btn"><i class="fas fa-times"></i></button>
    <div class="modal-header">
      <h3><i class="fas fa-user-plus"></i> Ajouter un utilisateur</h3>
    </div>
    <div class="modal-body">
      {{ error_container('addUserError') }}
      <form id="addUserForm" action="/admin/ajouter_utilisateur_ajax" method="POST">
        <div class="form-grid">
          <div class="form-group">
            <label>Nom :</label>
            <input type="text" name="nom" required>
          </div>
          <div class="form-group">
            <label>Prénom :</label>
            <input type="text" name="prenom" required>
          </div>
          <div class="form-group">
            <label>Login :</label>
            <input type="text" name="login" required>
          </div>
          <div class="form-group">
            <label>Rôle :</label>
            <select name="role" id="roleSelectAddUser" required>
              <option value="ADMIN">Administrateur</option>
              <option value="RESPONSABLE">Responsable</option>
              <option value="CHAUFFEUR">Chauffeur</option>
              <option value="MECANICIEN">Mécanicien</option>
              <option value="CHARGE">Chargé de transport</option>
            </select>
          </div>
          <div class="form-group">
            <label>Mot de passe :</label>
            <input type="password" name="mot_de_passe" required>
          </div>
          <div class="form-group">
            <label>Email :</label>
            <input type="email" name="email" required>
          </div>
          <div class="form-group">
            <label>Téléphone :</label>
            <input type="text" name="telephone" required>
          </div>
          <div class="form-group permis-only" style="display:none;">
            <label>Numéro de permis :</label>
            <input type="text" name="numero_permis">
          </div>
          <div class="form-group permis-only" style="display:none;">
            <label>Date de délivrance du permis :</label>
            <input type="date" name="date_delivrance_permis">
          </div>
          <div class="form-group permis-only" style="display:none;">
            <label>Date d'expiration du permis :</label>
            <input type="date" name="date_expiration_permis">
          </div>
        </div>
        <div class="form-actions">
          <button type="submit" class="submit-btn">
            <i class="fas fa-user-plus"></i> Ajouter l'utilisateur
          </button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Initialisation du gestionnaire unifié -->
{% from 'shared/macros/form_macros.html' import init_modal_form %}
{{ init_modal_form('addUserForm', 'addUserModal', 'addUserError', 'Utilisateur ajouté avec succès.') }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Gestionnaire pour le bouton de fermeture
    const closeBtn = document.getElementById('closeAddUserModal');
    if (closeBtn) {
        closeBtn.addEventListener('click', function() {
            FormModalManager.closeModal('addUserModal');
        });
    }
});
</script>
