# Dockerfile pour le développement - TransportUdM
# Version simplifiée pour un développement rapide

FROM python:3.11-slim

# Métadonnées
LABEL maintainer="Transport UdM Team"
LABEL description="Système de gestion des transports - Version Développement"
LABEL version="2.0.0-dev"

# Variables d'environnement pour le développement
ENV PYTHONUNBUFFERED=1
ENV PYTHONDONTWRITEBYTECODE=1
ENV FLASK_ENV=development
ENV FLASK_APP=run.py
ENV FLASK_DEBUG=1

# Installer les dépendances système
RUN apt-get update && apt-get install -y \
    build-essential \
    pkg-config \
    default-libmysqlclient-dev \
    libssl-dev \
    libffi-dev \
    curl \
    vim \
    && rm -rf /var/lib/apt/lists/*

# Créer l'utilisateur de développement
RUN groupadd -r devuser && useradd -r -g devuser -s /bin/bash devuser

# Créer le répertoire de travail
WORKDIR /app

# Copier et installer les dépendances Python
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Installer des outils de développement supplémentaires
RUN pip install --no-cache-dir \
    flask-debugtoolbar \
    ipython \
    ipdb

# Créer les répertoires nécessaires
RUN mkdir -p logs/audit uploads instance \
    && chown -R devuser:devuser /app

# Copier le code de l'application
COPY --chown=devuser:devuser . .

# Passer à l'utilisateur de développement
USER devuser

# Port d'exposition
EXPOSE 5000

# Script de démarrage pour le développement
CMD ["python", "run.py"]
