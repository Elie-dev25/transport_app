<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Carburation Modal Fix</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="app/static/css/dashboard-main.css?v=20250821">
    <link rel="stylesheet" href="app/static/css/vidanges.css">
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="logo">UDM</div>
            <div class="admin-info">
                <h2>Test Carburation</h2>
                <p>Modal Fix</p>
            </div>
        </div>
    </div>

    <!-- Top Bar -->
    <div class="top-bar">
        <h1 class="page-title">Test Correction Modal Carburation</h1>
        <div class="top-bar-actions">
            <div class="notification-bell">
                <i class="fas fa-bell"></i>
            </div>
            <div class="user-menu">
                <div class="user-avatar">T</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <div class="dashboard-content">
            <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 30px;">
                <h2>‚õΩ Test Correction Modal Carburation</h2>
                <p><strong>Probl√®me :</strong> Le bouton "Effectuer carburation" n'ouvrait pas la modale</p>
                
                <div style="margin: 15px 0; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                    <strong>‚úÖ Correction appliqu√©e :</strong><br>
                    ‚Ä¢ Ajout du support <code>aria-hidden="false"</code> dans modals.css<br>
                    ‚Ä¢ Compatibilit√© entre le syst√®me modulaire et le syst√®me carburation<br>
                    ‚Ä¢ CSS: <code>.modal.show, .modal[aria-hidden="false"]</code><br>
                    ‚Ä¢ R√©solution du conflit entre les deux syst√®mes de modales
                </div>
            </div>

            <!-- Test Table -->
            <div style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);">
                <h2 style="color: #1e3a8a; margin-bottom: 25px;">
                    <i class="fas fa-gas-pump"></i>
                    Test Bouton Carburation
                </h2>
                
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="background: #f8fafc;">
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">Num√©ro</th>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">Immatriculation</th>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">Carburant</th>
                            <th style="padding: 15px; text-align: left; border-bottom: 2px solid #e5e7eb;">Action</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">AED-001</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">ABC-123-XY</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">45 L</td>
                            <td style="padding: 15px; border-bottom: 1px solid #e5e7eb;">
                                <button class="btn-action btn-carburation"
                                        data-aed-id="1"
                                        data-numero="AED-001"
                                        data-immatriculation="ABC-123-XY"
                                        data-effectue-par="Test User">
                                    <i class="fas fa-gas-pump"></i>
                                    Effectuer Carburation
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
                
                <div style="margin-top: 20px; padding: 15px; background: #f0f9ff; border-radius: 8px;">
                    <strong>üìã Instructions de Test :</strong><br>
                    1. Cliquez sur le bouton "Effectuer Carburation"<br>
                    2. La modale "Fiche de Carburation" devrait s'ouvrir<br>
                    3. V√©rifiez que les donn√©es sont pr√©-remplies<br>
                    4. Testez le bouton "Confirmer la carburation"<br>
                    5. Testez la fermeture avec la croix
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Carburation (copi√© du template original) -->
    <div id="ficheCarburationModal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <button class="close" aria-label="Fermer" onclick="closeCarburationFiche()">&times;</button>
            <h2 style="margin-bottom:18px;"><i class="fas fa-gas-pump"></i> Fiche de Carburation</h2>
            <div id="fiche-carburation-content">
                <div class="fiche-vidange-form">
                    <div style="margin-bottom:12px;">
                        <strong>Date et heure :</strong> <span id="fiche-carburation-date-heure">-</span>
                    </div>
                    <div style="margin-bottom:12px;">
                        <strong>Op√©rateur :</strong> <span id="fiche-carburation-operateur">-</span>
                    </div>
                    <div style="margin-bottom:12px;">
                        <strong>Num√©ro AED :</strong> <span id="fiche-carburation-numero">-</span>
                    </div>
                    <div style="margin-bottom:12px;">
                        <strong>Immatriculation :</strong> <span id="fiche-carburation-immatriculation">-</span>
                    </div>
                </div>
            </div>
            <div style="display:flex;gap:12px;justify-content:center;margin-top:20px;">
                <button class="action-btn" onclick="openFormulaireCarburation()">
                    <i class="fas fa-check"></i> Confirmer la carburation
                </button>
                <button class="action-btn" style="background:#6b7280;" onclick="printCarburationFiche()">
                    <i class="fas fa-print"></i> Imprimer
                </button>
            </div>
        </div>
        
        <!-- Variables cach√©es pour transfert -->
        <input type="hidden" id="carburation_aed_id_hidden" />
        <input type="hidden" id="carburation_numero_hidden" />
        <input type="hidden" id="carburation_operateur_hidden" />
    </div>

    <!-- Modal Formulaire -->
    <div id="formulaireCarburationModal" class="modal" aria-hidden="true">
        <div class="modal-content">
            <button class="close" aria-label="Fermer" onclick="closeFormulaireCarburation()">&times;</button>
            <h2 style="margin-bottom:18px;">Formulaire de confirmation carburation</h2>
            <form id="formulaire-carburation">
                <input type="hidden" id="aed_id_hidden" name="aed_id_hidden">
                <div style="margin-bottom:12px;">
                    <label for="numero_aed">Num√©ro AED :</label>
                    <input type="text" id="numero_aed" name="numero_aed" readonly 
                           style="width:100%;padding:8px;border-radius:8px;border:1px solid #e5e7eb;background:#f3f4f6;">
                </div>
                <div style="margin-bottom:12px;">
                    <label for="quantite_input">Quantit√© (L) :</label>
                    <input type="number" id="quantite_input" name="quantite_input" min="0" step="0.1" required 
                           style="width:100%;padding:8px;border-radius:8px;border:1px solid #e5e7eb;">
                </div>
                <div style="display:flex;gap:12px;justify-content:center;margin-top:20px;">
                    <button type="submit" class="action-btn">
                        <i class="fas fa-save"></i> Enregistrer
                    </button>
                    <button type="button" class="action-btn" style="background:#6b7280;" onclick="closeFormulaireCarburation()">
                        <i class="fas fa-times"></i> Annuler
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // JavaScript copi√© du template original
        document.addEventListener('DOMContentLoaded', function () {
            // Ouvrir la fiche √† partir du tableau
            document.querySelectorAll('.btn-carburation').forEach(btn => {
                btn.addEventListener('click', function() {
                    const aedId = this.getAttribute('data-aed-id');
                    const numero = this.getAttribute('data-numero');
                    const immat = this.getAttribute('data-immatriculation');
                    const operateur = this.getAttribute('data-effectue-par');

                    // Remplir la fiche
                    document.getElementById('fiche-carburation-numero').textContent = numero || '-';
                    document.getElementById('fiche-carburation-immatriculation').textContent = immat || '-';
                    document.getElementById('fiche-carburation-operateur').textContent = operateur || '-';
                    const now = new Date();
                    const formatted = now.toLocaleDateString('fr-FR', { day: '2-digit', month: '2-digit', year: 'numeric' }) + ' ' + now.toLocaleTimeString('fr-FR');
                    document.getElementById('fiche-carburation-date-heure').textContent = formatted;

                    // Stocker pour le formulaire
                    document.getElementById('carburation_aed_id_hidden').value = aedId || '';
                    document.getElementById('carburation_numero_hidden').value = numero || '';
                    document.getElementById('carburation_operateur_hidden').value = operateur || '';

                    openCarburationFiche();
                    console.log('‚úÖ Bouton carburation cliqu√© - Modal devrait s\'ouvrir');
                });
            });
        });

        // Helpers d'ouverture/fermeture
        function openCarburationFiche() {
            const m = document.getElementById('ficheCarburationModal');
            if (m) {
                m.setAttribute('aria-hidden', 'false');
                console.log('‚úÖ Modal carburation ouverte (aria-hidden=false)');
            }
        }
        
        function closeCarburationFiche() {
            const m = document.getElementById('ficheCarburationModal');
            if (m) {
                m.setAttribute('aria-hidden', 'true');
                console.log('‚úÖ Modal carburation ferm√©e (aria-hidden=true)');
            }
        }
        
        function openFormulaireCarburation() {
            // Alimenter le formulaire depuis les hidden de la fiche
            const aedId = document.getElementById('carburation_aed_id_hidden').value;
            const numero = document.getElementById('carburation_numero_hidden').value;
            document.getElementById('aed_id_hidden').value = aedId || '';
            document.getElementById('numero_aed').value = numero || '';
            
            // Fermer la fiche et ouvrir le formulaire
            closeCarburationFiche();
            const m = document.getElementById('formulaireCarburationModal');
            if (m) {
                m.setAttribute('aria-hidden', 'false');
                console.log('‚úÖ Modal formulaire ouverte');
            }
        }
        
        function closeFormulaireCarburation() {
            const m = document.getElementById('formulaireCarburationModal');
            if (m) {
                m.setAttribute('aria-hidden', 'true');
                console.log('‚úÖ Modal formulaire ferm√©e');
            }
        }

        function printCarburationFiche() {
            console.log('üñ®Ô∏è Impression de la fiche (simulation)');
        }

        console.log('‚õΩ Test Carburation Modal Fix charg√©');
        console.log('üîß Correction appliqu√©e : support aria-hidden dans modals.css');
    </script>
</body>
</html>
